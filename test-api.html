<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .test-button:hover {
            background-color: #45a049;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>API兼容性测试</h1>
        
        <div class="test-section">
            <h2>1. 测试API连接</h2>
            <button class="test-button" onclick="testApiConnection()">测试连接</button>
            <div id="connection-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. 测试个人资料API</h2>
            <button class="test-button" onclick="testPersonalApi()">测试个人资料</button>
            <div id="personal-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>3. 测试作品API</h2>
            <button class="test-button" onclick="testProjectsApi()">测试作品</button>
            <div id="projects-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>4. 测试经历API</h2>
            <button class="test-button" onclick="testExperiencesApi()">测试经历</button>
            <div id="experiences-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>5. 测试技能API</h2>
            <button class="test-button" onclick="testSkillsApi()">测试技能</button>
            <div id="skills-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>6. 测试工具API</h2>
            <button class="test-button" onclick="testToolsApi()">测试工具</button>
            <div id="tools-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>7. 测试所有数据API</h2>
            <button class="test-button" onclick="testAllApi()">测试所有数据</button>
            <div id="all-result" class="result"></div>
        </div>
    </div>
    
    <script>
        // 配置API地址（与现有前端代码保持一致）
        const API_URL = 'https://personal-website-api.1950837615.workers.dev/';
        
        // 使用fetch发送请求的封装函数，兼容现有API结构
        function apiRequest(action, data = null, method = 'GET') {
            // 构建URL
            const url = `${API_URL}?action=${action}`;
            
            // 构建请求配置
            const config = {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                }
            };
            
            // 添加请求体
            if (data && method !== 'GET') {
                config.body = JSON.stringify(data);
            }
            
            // 发送请求
            return fetch(url, config)
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        throw new Error(data.message || '请求失败');
                    }
                    return data;
                });
        }
        
        // 显示结果
        function showResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${success ? 'success' : 'error'}`;
        }
        
        // 测试API连接
        function testApiConnection() {
            showResult('connection-result', false, '测试中...');
            
            apiRequest('personal')
                .then(data => {
                    showResult('connection-result', true, 'API连接成功！\n\n响应数据：\n' + JSON.stringify(data, null, 2));
                })
                .catch(error => {
                    showResult('connection-result', false, 'API连接失败：\n' + error.message);
                });
        }
        
        // 测试个人资料API
        function testPersonalApi() {
            showResult('personal-result', false, '测试中...');
            
            apiRequest('personal')
                .then(data => {
                    showResult('personal-result', true, '个人资料API测试成功！\n\n数据：\n' + JSON.stringify(data.data, null, 2));
                })
                .catch(error => {
                    showResult('personal-result', false, '个人资料API测试失败：\n' + error.message);
                });
        }
        
        // 测试作品API
        function testProjectsApi() {
            showResult('projects-result', false, '测试中...');
            
            apiRequest('projects')
                .then(data => {
                    showResult('projects-result', true, `作品API测试成功！共返回 ${data.data.length} 个作品\n\n数据：\n` + JSON.stringify(data.data, null, 2));
                })
                .catch(error => {
                    showResult('projects-result', false, '作品API测试失败：\n' + error.message);
                });
        }
        
        // 测试经历API
        function testExperiencesApi() {
            showResult('experiences-result', false, '测试中...');
            
            apiRequest('experiences')
                .then(data => {
                    showResult('experiences-result', true, `经历API测试成功！共返回 ${data.data.length} 条经历\n\n数据：\n` + JSON.stringify(data.data, null, 2));
                })
                .catch(error => {
                    showResult('experiences-result', false, '经历API测试失败：\n' + error.message);
                });
        }
        
        // 测试技能API
        function testSkillsApi() {
            showResult('skills-result', false, '测试中...');
            
            apiRequest('skills')
                .then(data => {
                    showResult('skills-result', true, `技能API测试成功！共返回 ${data.data.length} 个技能\n\n数据：\n` + JSON.stringify(data.data, null, 2));
                })
                .catch(error => {
                    showResult('skills-result', false, '技能API测试失败：\n' + error.message);
                });
        }
        
        // 测试工具API
        function testToolsApi() {
            showResult('tools-result', false, '测试中...');
            
            apiRequest('tools')
                .then(data => {
                    showResult('tools-result', true, `工具API测试成功！共返回 ${data.data.length} 个工具\n\n数据：\n` + JSON.stringify(data.data, null, 2));
                })
                .catch(error => {
                    showResult('tools-result', false, '工具API测试失败：\n' + error.message);
                });
        }
        
        // 测试所有数据API
        function testAllApi() {
            showResult('all-result', false, '测试中...');
            
            apiRequest('all')
                .then(data => {
                    showResult('all-result', true, `所有数据API测试成功！\n\n数据包含：\n- 个人资料：${JSON.stringify(data.data.personal.name)}的信息\n- 作品：${data.data.projects.length}个\n- 经历：${data.data.experiences.length}条\n- 技能：${data.data.skills.length}个\n- 工具：${data.data.tools.length}个\n\n完整数据：\n` + JSON.stringify(data.data, null, 2));
                })
                .catch(error => {
                    showResult('all-result', false, '所有数据API测试失败：\n' + error.message);
                });
        }
        
        // 页面加载时自动测试连接
        window.onload = function() {
            testApiConnection();
        };
    </script>
</body>
</html>